# send_sequrity_email.py

## Описание
`send_sequrity_email.py` реализует сервис отправки почтовых уведомлений с поддержкой плановой квартальной рассылки и конфигурации через `.env`. Скрипт работает в режиме сервиса: периодически просыпается по интервалу, проверяет наступление нового квартала и при необходимости отправляет одно уведомление.

## Зависимости
- Python 3.x
- Библиотека `smtplib` (встроена в Python)
- Библиотека `email` (встроена в Python)
- `apscheduler`
- `python-dotenv`

## Конфигурация через .env
Обязательные переменные окружения:
- `SMTP_SERVER` — SMTP сервер.
- `SMTP_PORT` — порт SMTP.
- `SMTP_USER` — логин SMTP (используется как отправитель по умолчанию).
- `SMTP_PASSWORD` — пароль SMTP.
- `EMAIL_RECIPIENT` — основной получатель уведомлений.

Дополнительные переменные:
- `EMAIL_SENDER` — явный отправитель (если не задан, используется `SMTP_USER`).
- `TEST_EMAIL` — тестовый адрес. Если указан, письмо отправляется на него вместо `EMAIL_RECIPIENT` без изменения основной конфигурации.
- `SERVICE_START` — флаг запуска сервиса (`True`/`False`).
- `SERVICE_INTERVAL` — интервал проверки планировщика (например: `60 minutes`). Используется только для периодичности проверки, а не для определения квартала.

## Принцип работы квартального планировщика
Планировщик запускается с интервалом, заданным `SERVICE_INTERVAL`, и на каждом запуске выполняет:
1. Определение текущего квартала (январь–март, апрель–июнь, июль–сентябрь, октябрь–декабрь).
2. Сравнение с сохраненным кварталом последней отправки.
3. Если квартал новый — отправляет письмо и сохраняет состояние. Если квартал тот же — ничего не отправляет.

Пример поведения: при старте сервиса в середине квартала письмо не отправляется. При первом запуске в новом квартале будет отправлено одно уведомление, даже если сервис пропустил первый день квартала (отправка произойдет при ближайшем запуске планировщика в этом квартале).

## Различие тестовой и боевой отправки
- **Боевая отправка**: `TEST_EMAIL` не задан, письмо отправляется на `EMAIL_RECIPIENT`.
- **Тестовая отправка**: `TEST_EMAIL` задан, письмо отправляется только на тестовый адрес, не меняя основную конфигурацию.

## Использование
1. Создайте `.env` на основе `.env.example`.
2. Заполните SMTP-параметры и `EMAIL_RECIPIENT`.
3. Запустите сервис:
```bash
python send_sequrity_email.py
```

## Отдельный файл конфигурации
Если основной сервис `Notific.py` использует свой `.env`, можно задать отдельный файл для этого сервиса через переменную `SEQURITY_ENV_FILE`.

Пример (Linux):
```bash
export SEQURITY_ENV_FILE=/opt/www/email_notifications_current/.env.sequrity
python send_sequrity_email.py
```

Пример (Windows):
```cmd
set SEQURITY_ENV_FILE=C:\Users\VARSLAVAN\Projects\email_notifications_current\.env.sequrity
python send_sequrity_email.py
```
